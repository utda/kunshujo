<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <script
  src="//code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>

  <link rel="stylesheet" type="text/css" href="assets/thirdparty/jquery-mosaic/jquery.mosaic.css"/>
  <script type="text/javascript" src="assets/thirdparty/jquery-mosaic/jquery.mosaic.js"></script>


  <title>『捃拾帖』デジタル展示</title>

  <script src="./assets/js/main.js"></script>

  <script>asset('./');</script>

  <style>
  .pagetop a {
    filter:alpha(opacity=80);
    -moz-opacity: 0.8;
    opacity: 0.8;
  }
  .pagetop a:hover {
    filter:alpha(opacity=80);
    -moz-opacity: 0.8;
    opacity: 0.8;
  }
  </style>

</head>
<body>

  <script>header('./');</script>

  <div class="container-fluid py-2 my-5">

    <h3 class="mb-5 text-center">ランダムに<span id="n"></span>件を抽出して表示します</h3>

    <div class="text-center" id="loading">
      <img src="https://img.buzzfeed.com/buzzfeed-static/static/enhanced/web05/2012/4/24/16/anigif_enhanced-buzz-10731-1335299292-14.gif" class="img-fluid"/>
    </div>

    <div id="myMosaic"></div>

  </div>

  <p class="pagetop"><a href="#wrap">▲</a></p>

  <script>


  var dcterms = "http://purl.org/dc/terms/"
  var foaf = "http://xmlns.com/foaf/0.1/"

  var n = 250
  $("#n").append(n)

  var i_arr = []

  jQuery(document).ready(function() {

    $.ajax({
      url:'data/data.json'
    })
    .then(
      // 1つめは通信成功時のコールバック
      function (result) {

        var arr = [dcterms+"description", dcterms+"extent", dcterms+"coverage", dcterms+"type", dcterms+"format", dcterms+"subject"]

        for (var i = 0; i < n; i++) {

          var j = Math.floor(Math.random()*result.length)

          while(i_arr.indexOf(j) != -1){
            j = Math.floor(Math.random()*result.length)
          }
          
          i_arr.push(j)

          var obj = result[j];

          if(obj[foaf+"thumbnail"]){

            var url = obj[foaf+"thumbnail"][0]["@id"].replace("/,300/", "/,200/")

            var area = url.split("/")[6].split(",")

            var img = $("<img>")
            img.attr("src", url)
            img.attr("data-high-res-image-src", url)
            img.attr("width", area[2])
            img.attr("height", area[3])
            img.attr("onclick", "move('"+obj[dcterms+"relation"][0]["@id"].replace("#", "&pos=")+"')")
            img.attr("style", "cursor: pointer")

            $("#myMosaic").append(img)
          }

        }

        $('#myMosaic').Mosaic({
          maxRowHeight: 200,
          innerGap : 10
        });


      },
      // 2つめは通信失敗時のコールバック
      function () {
        alert(data.statusText);
      }
    ).always(function() {
      $("#loading").empty()
    });

  })

  function move(curation){
    open( "http://codh.rois.ac.jp/software/iiif-curation-viewer/demo/?curation="+curation, "cr" ) ;
  }

</script>
</body>
</html>
